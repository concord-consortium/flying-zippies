<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8" />
<title>Scene 10 - The Flying Zippies</title>
<link rel="stylesheet" href="_assets/css/default.css" />
</head>
<body>
<div id="page-container">
  <div id="stage">
    <video id="video" poster="_assets/video/10.jpg" preload="auto" webkit-playsinline playsinline>
      <source src="_assets/video/10.mp4" type="video/mp4" />
    </video>
    <!-- end #video -->
    <div id="model-container">
      <div id="iframe-container-outer">
        <div id="iframe-container-inner">
          <iframe id="interactive-iframe" width="100%" height="100%" src="lab/embeddable.html"></iframe>
        </div>
      </div>
      <div id="net"></div>
    </div>
    <!-- end #model-container -->
  </div>
  <!-- end #stage -->
  <div id="controls">
      <div id="text">
        <p></p>
      </div>
      <a href="#" id="play" title="Play audio" onclick="return false;" style="display: block; opacity: 1;">play audio</a>
      <a href="#" id="reload" title="Reload page" onclick="location.reload(); return false;">reload page</a>
      <a href="9.html" id="left" title="Go backward one page">go back</a>
      <a href="11.html" id="right" title="Go forward one page">continue</a>
      <a href="index.html" id="home" title="Go to the home page">home</a>
  </div>
  <!-- /#controls -->
</div>
<!-- end #page-container -->
<audio id="audio" src="_assets/audio/10-a.mp3" preload="auto" />

<script src="_assets/js/jquery-2.1.0.min.js"></script>
<script src="_assets/js/iframe-phone.js"></script>
<script src="_assets/js/functions.js"></script>
<script>
var interactive = new iframePhone.ParentEndpoint($('#interactive-iframe')[0]);
$.get('interactives/model-zippy-torches-going-out.json', (json) => {
  if (typeof json === "string") json = JSON.parse(json);
  interactive.post('loadInteractive', json);
});

interactive.addListener('modelLoaded', function() {
  interactive.post('stop');
});

var final_question_timer, audio_icon_flasher, instructions_counter = 0;
var instructions = [
  'Wow! What a show! The Zippies really got moving when the faster air started bumping them! But now the crowd wants to see the next act, and we need to get the Zippies back down. But how? They keep flying around and need to come down!',
  'Do you have any ideas about how I can get the Zippies back down to the ground?',
  'I know! Maybe we could catch them in a big net, pour them back into the cart and return them to their dressing room.',
  'Do you think Matilda using this big net is a good way to get the Flying Zippies back down?',
  'Let\'s see what is really happening when Matilda tries to catch the Flying Zippies in her net.'
  ];

$(document).ready(function() {
  initializePage();
  $('#video').bind('ended', function(){
    showTheModel();
    finalQuestion();
  });
  $('#audio').bind('timeupdate', function(){
    if(this.currentTime < 1 && this.currentTime > .1) {
      $('#text p').html(instructions[0]);
    }
    if(this.currentTime >= 18.5) {
      $('#text p').html(instructions[1]);
    }
    if (this.currentTime >= 24.5) {
      $('#audio').get(0).pause();
      $('#video').get(0).pause();
      $('#play').css({'opacity': .6});
      $('#play').unbind('click');
      next_question_timer = setTimeout('nextQuestion()', 8000);
    }
  });
});

function nextQuestion() {
  clearTimeout(next_question_timer);
  $('#audio').unbind('timeupdate');
  $('#audio').bind('timeupdate', function(){
    if(this.currentTime >= 25) {
      $('#text p').html(instructions[2]);
    }
    if(this.currentTime >= 32.5) {
      $('#text p').html(instructions[3]);
    }
  });
  $('#play').unbind('click').click(function() {
    $('#video').get(0).play();
    $('#audio').get(0).play();
  });
  audioIconFlasher('go');
}

function finalQuestion() {
  net_timer = setTimeout("moveNet('left')", 100);
  $('#video').unbind('ended');
  $('#audio').unbind('timeupdate');
  $('#audio').attr('src', '_assets/audio/10-b.mp3');
  $('#audio').get(0).play();
  $('#text p').html(instructions[4]);
  setTimeout('enableNextLink()', 8000);
}

function finalQuestion() {

}

function moveNet(direction) {
  clearTimeout(net_timer);
  var x_pos = parseFloat($('#net').css('left'));
  var y_pos = parseFloat($('#net').css('top'));

  if (x_pos > -332 && direction == 'left') {
    $('#net').removeClass('right').animate({'left': '-332px'}, 3000);
    direction = 'left';
  } else if (x_pos < 1000 && direction == 'right') {
    $('#net').addClass('right').animate({'left': '1000px'}, 3000);
    direction = 'right';
  } else if (x_pos == -332) {
    direction = 'right';
  } else {
    $('#net').removeClass('right');
    direction = 'left';
  }
  net_timer = setTimeout('moveNet("' + direction + '")', 100);
}
</script>
</body>
</html>
